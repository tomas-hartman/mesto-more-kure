# Data scheme & game functionality

## Game start

1. Client to server: game setup

Defaults:

```js
{
    settings: {
            players: 2,
            categories: 5,
            rounds: 3,
            id: "game_id"
        }
}
```

Game id generated by server? by client? (to keep track of which game is which?)

## Server

2. Server waits for other players and generates players

```js
[
  {
    nick: "Player 1",
    id: "player1_id"
  }
];
```

id generated by server

3. Server generates gameplan based on settings

One round example:

```js
{
    letters: ["r","e","m"],
    categories: [
        ["osobnost", "mesto", "jidlo", "reka", "stat"], // generated randomly for each round
        ...
    ]
}
```

4. Server keeps information about game progress

```js
{
    gameProgress: {
        round: 1,
        category: 1,
        answered: []
    }
}
```

5. Server emits game instructions for each turn and sends it to clients

```js
{
    letter: game.letters[gameProgress.round - 1],
    category: game.categories[gameProgress.round - 1][gameProgress.category -1]
}
```

Along with this, server updates game progress.
Then waits for client response.

6. Client gets instructions from server and updates react's state -> rerenders game screen
7. Client waits 15 seconds (?) for answer or until answer is submitted, then sends

```js
{
    player: "player_id",
    answered: true
}
```

8. Client saves answer into its state

```js
{
  answers: ["answer_1", "answer_2", "answer_n"],
}
```

9. server waits for answer token from all players and saves each token into game progress' answered

```js
{
  answered: ["player_1", "player_2"];
}
```

10. as soon as `answered.length === number of players`, answered is erased and server emits another instruction

---

11. when the game ends, all players' answers are send to validation and evaluation to other players
    @todo promyslet, jak dát klientovi vědět, jakýho playera bude evaluovat

```js
[
    {
        player: "player_id",
        answers: [ ... ]
    }
]
```

12. Only `players[players.length+1]` validates the answers (circulary)
13. TBA validation rules - will check if answers are the same etc.
14. Client validates the data and shows the rest of them to player to evaluate them, then, points are counted together and sent to server

@TODO data structure

15. server waits for all evaluations (in game progress)

```js
{
  evaluated: ["played1_id", "player2_id"];
}
```

16. As soon as `evaluated.length === number of players`, server creates final results state and sends it to clients to show who won

```js
{
  results: [
    {
      player: "player_id",
      points: 16
    },
    {
      player: "player2_id",
      points: 20
    }
  ];
}
```
